<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Lecture Timestamp Helper — UPSC Prep</title>
<style>
  :root{
    --bg:#0f1724;
    --card:#0b1220;
    --muted:#9aa4b2;
    --accent:#6ee7b7;
    --accent-2:#60a5fa;
    --glass: rgba(255,255,255,0.03);
    --glass-2: rgba(255,255,255,0.02);
    --danger:#ff7b7b;
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  html,body{height:100%;margin:0;background:radial-gradient(1200px 600px at 10% 10%, rgba(96,165,250,0.06), transparent), radial-gradient(1000px 400px at 90% 90%, rgba(110,231,183,0.04), transparent), var(--bg);color:#d8e1ea}
  .app{
    max-width:980px;margin:32px auto;padding:24px;
    display:grid;grid-template-columns:1fr 380px;gap:20px;
  }
  header{grid-column:1/-1;display:flex;align-items:center;gap:14px}
  .logo{
    width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent-2));
    display:flex;align-items:center;justify-content:center;color:#07203a;font-weight:700;font-size:18px;box-shadow:0 6px 18px rgba(2,6,23,0.6);
  }
  h1{font-size:18px;margin:0}
  p.lead{margin:0;color:var(--muted);font-size:13px}
  /* Card */
  .card{background:linear-gradient(180deg,var(--card), rgba(255,255,255,0.01));padding:18px;border-radius:14px;box-shadow:0 6px 20px rgba(2,6,23,0.6);border:1px solid var(--glass-2)}
  .controls{display:flex;flex-direction:column;gap:12px}
  label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
  input[type="text"], input[type="time"]{
    width:100%;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;font-size:14px;outline:none;
  }
  .row{display:flex;gap:10px}
  .row .flex{flex:1}
  .btn{
    display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border-radius:10px;border:none;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#04202b;font-weight:600;cursor:pointer;box-shadow:0 6px 18px rgba(60,90,120,0.08);transition:transform .12s ease, box-shadow .12s;
  }
  .btn:hover{transform:translateY(-3px)}
  .btn.ghost{background:transparent;border:1px solid var(--glass);color:var(--accent-2);font-weight:600}
  .btn.danger{background:linear-gradient(90deg,var(--danger), #ff4f4f);color:#200; box-shadow:none}
  .small{padding:8px 10px;border-radius:8px;font-weight:600}
  .muted{color:var(--muted)}
  .output{margin-top:12px;padding:12px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border:1px solid var(--glass)}
  .list{display:flex;flex-direction:column;gap:8px;margin-top:10px}
  .item{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:10px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border:1px solid rgba(255,255,255,0.02)}
  .meta{font-size:13px;color:var(--muted)}
  .item .timeblock{font-weight:700}
  .actions{display:flex;gap:8px;flex-shrink:0}
  .chip{padding:6px 8px;border-radius:8px;border:1px solid var(--glass);background:transparent;cursor:pointer;font-size:13px}
  .chip:hover{transform:translateY(-3px)}
  footer{grid-column:1/-1;margin-top:8px;color:var(--muted);font-size:13px;text-align:center}
  /* right column */
  .right{display:flex;flex-direction:column;gap:12px}
  .small-info{font-size:13px;color:var(--muted)}
  .stats{display:flex;gap:10px}
  .stat{flex:1;padding:10px;border-radius:10px;background:var(--glass);text-align:center}
  .empty{opacity:0.6;text-align:center;padding:18px;border-radius:10px;border:1px dashed rgba(255,255,255,0.03)}
  /* responsive */
  @media (max-width:980px){
    .app{grid-template-columns:1fr; padding:18px}
    .right{order:3}
  }
  /* tiny helpers */
  .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace}
  .success{color:var(--accent-2)}
  .error{color:var(--danger)}
  .hint{font-size:12px;color:var(--muted);margin-top:6px}
  .actions .iconbtn{background:transparent;border:1px solid var(--glass);padding:8px;border-radius:8px;cursor:pointer}
  .actions .iconbtn:hover{transform:translateY(-3px)}
  .topbar{display:flex;gap:8px;align-items:center}
  .exportRow{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .tag{background: rgba(255,255,255,0.02);padding:6px 8px;border-radius:8px;border:1px solid rgba(255,255,255,0.02);font-size:13px}
</style>
</head>
<body>
<div class="app">
  <header>
    <div class="logo">UPS</div>
    <div>
      <h1>Lecture Timestamp Helper</h1>
      <p class="lead">Quickly convert missed lecture offsets into absolute video times — save, copy, export and revisit exact moments.</p>
    </div>
  </header>

  <!-- LEFT: main controls -->
  <main class="card">
    <div class="controls">
      <div class="topbar">
        <div style="flex:1">
          <label>Lecture Start Time</label>
          <div class="row">
            <input id="startInput" type="text" placeholder="HH:MM or HH:MM:SS (e.g. 09:30 or 09:30:00)" />
            <button id="setNowBtn" class="btn small" title="Set to current time">Set Start Time (Now)</button>
          </div>
          <div class="hint">You can type hours and minutes (HH:MM) or include seconds (HH:MM:SS). If seconds missing, assumes :00.</div>
        </div>
      </div>

      <div>
        <label>Missed timestamp(s)</label>
        <input id="missInput" type="text" placeholder="Single: 00:45:30  —  Range: 00:45:30 - 00:50:00  —  Multiple add to list" />
        <div class="row" style="margin-top:8px">
          <button id="addBtn" class="btn">Add to list</button>
          <button id="parseSample" class="btn ghost small">Example formats</button>
          <button id="clearAll" class="btn small" style="background:transparent;border:1px dashed rgba(255,255,255,0.04)">Clear list</button>
        </div>
        <div class="hint">Accepts: MM:SS | HH:MM:SS | HH:MM:SS - HH:MM:SS. You can paste multiple lines but add one-by-one for clarity.</div>
      </div>

      <div class="output">
        <label>Calculated Results</label>
        <div id="resultsArea" class="muted">No entries yet — add missed timestamps and they'll appear below with absolute times.</div>

        <div class="list" id="entriesList" style="margin-top:12px"></div>

        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
          <div class="small-info"><strong id="countBadge">0</strong> missed item(s)</div>
          <div class="exportRow">
            <button id="exportTxt" class="btn ghost small">Export TXT</button>
            <button id="exportCsv" class="btn ghost small">Export CSV</button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- RIGHT: sidebar -->
  <aside class="right">
    <div class="card">
      <h3 style="margin:0 0 10px 0">Quick actions</h3>
      <div style="display:flex;flex-direction:column;gap:8px">
        <div class="row">
          <button id="copyAll" class="btn">Copy all times</button>
          <button id="pasteExample" class="btn ghost small">Paste example</button>
        </div>
        <div class="hint">Use copy buttons to paste exact timestamps into your video player (YouTube/players accept HH:MM:SS format).</div>
      </div>
    </div>

    <div class="card">
      <h4 style="margin:0 0 8px 0">Stats & tips</h4>
      <div class="stats">
        <div class="stat">
          <div class="mono" id="statCount">0</div>
          <div class="muted">Saved</div>
        </div>
        <div class="stat">
          <div class="mono" id="statRanges">0</div>
          <div class="muted">Ranges</div>
        </div>
      </div>
      <div style="margin-top:12px" class="small-info">
        Tip: click a copied time and paste it into YouTube by adding it after the URL like <span class="mono">?t=HHmMMs</span> or directly seek to HH:MM:SS.
      </div>
    </div>

    <div class="card empty">
      <div style="font-weight:700">Suggested workflow</div>
      <ol style="text-align:left;padding-left:16px;margin:8px 0 0 0;color:var(--muted)">
        <li>Set the lecture start (or click <em>Set Start Time</em> at lecture start).</li>
        <li>When you miss something, jot down offset and click <em>Add to list</em>.</li>
        <li>Use copy/export to revisit exact moments in the recorded video.</li>
      </ol>
    </div>
  </aside>

  <footer>
    Built for UPSC prep — precise timestamps, simple export. — <span class="muted">No data leaves your browser</span>
  </footer>
</div>

<script>
/* -------------------------
   Helper functions
   ------------------------- */
function pad(n){return n.toString().padStart(2,'0')}
function parseTimeStringToSeconds(s){
  // Accepts: SS, MM:SS, HH:MM:SS, or when given like "1:23" treat as MM:SS
  if(!s) return null;
  s = s.trim();
  // Remove stray characters
  s = s.replace(/\s+/g,'');
  var parts = s.split(':').map(p=>p.replace(/^0+([0-9])/, '$1'));
  if(parts.length === 1){
    // seconds only
    var sec = parseInt(parts[0],10);
    if(isNaN(sec)) return null;
    return sec;
  } else if(parts.length === 2){
    var mm = parseInt(parts[0],10), ss = parseInt(parts[1],10);
    if(isNaN(mm) || isNaN(ss)) return null;
    return mm*60 + ss;
  } else if(parts.length === 3){
    var hh = parseInt(parts[0],10), mm = parseInt(parts[1],10), ss = parseInt(parts[2],10);
    if(isNaN(hh) || isNaN(mm) || isNaN(ss)) return null;
    return hh*3600 + mm*60 + ss;
  } else {
    return null;
  }
}

function parseStartInputToSecondsOfDay(s){
  // Accepts HH:MM or HH:MM:SS
  if(!s) return null;
  s = s.trim();
  if(!/^\d{1,2}:\d{1,2}(:\d{1,2})?$/.test(s)) return null;
  var parts = s.split(':').map(p=>parseInt(p,10));
  var hh = parts[0]||0, mm = parts[1]||0, ss = parts[2]||0;
  if(isNaN(hh)||isNaN(mm)||isNaN(ss)) return null;
  // Normalize
  hh = Math.floor(hh);
  mm = Math.floor(mm);
  ss = Math.floor(ss);
  if(hh<0||hh>23||mm<0||mm>59||ss<0||ss>59) return null;
  return hh*3600 + mm*60 + ss;
}

function formatSecondsToHHMMSS(totalSeconds){
  totalSeconds = Math.floor(totalSeconds);
  totalSeconds = ((totalSeconds % 86400) + 86400) % 86400; // wrap within day
  var hh = Math.floor(totalSeconds/3600);
  var mm = Math.floor((totalSeconds%3600)/60);
  var ss = totalSeconds%60;
  return pad(hh)+':'+pad(mm)+':'+pad(ss);
}

/* -------------------------
   App state
   ------------------------- */
let entries = []; // {rawInput, type:'single'|'range', offsetStartSec, offsetEndSec, absoluteStart, absoluteEnd, id}
let startSecondsOfDay = null; // seconds from midnight

/* -------------------------
   UI references & events
   ------------------------- */
const startInput = document.getElementById('startInput');
const setNowBtn = document.getElementById('setNowBtn');
const missInput = document.getElementById('missInput');
const addBtn = document.getElementById('addBtn');
const entriesList = document.getElementById('entriesList');
const resultsArea = document.getElementById('resultsArea');
const countBadge = document.getElementById('countBadge');
const statCount = document.getElementById('statCount');
const statRanges = document.getElementById('statRanges');
const exportTxt = document.getElementById('exportTxt');
const exportCsv = document.getElementById('exportCsv');
const clearAll = document.getElementById('clearAll');
const copyAll = document.getElementById('copyAll');
const parseSample = document.getElementById('parseSample');
const pasteExample = document.getElementById('pasteExample');

setNowBtn.addEventListener('click', ()=>{
  const now = new Date();
  const hh = pad(now.getHours()), mm = pad(now.getMinutes()), ss = pad(now.getSeconds());
  startInput.value = hh+':'+mm+':'+ss;
  startSecondsOfDay = parseStartInputToSecondsOfDay(startInput.value);
  refreshUI();
});

startInput.addEventListener('change', ()=>{
  startSecondsOfDay = parseStartInputToSecondsOfDay(startInput.value);
  if(startSecondsOfDay === null){
    resultsArea.innerHTML = '<div class="error">Invalid start time. Use HH:MM or HH:MM:SS (24-hour).</div>';
  } else {
    resultsArea.innerHTML = '<div class="success">Start time set to <strong>'+formatSecondsToHHMMSS(startSecondsOfDay)+'</strong>.</div>';
    // refresh absolute times
    recomputeAbsoluteTimes();
  }
});

parseSample.addEventListener('click', ()=>{
  alert('Examples:\n • Single: 45:30  (MM:SS)\n • Single: 00:45:30  (HH:MM:SS)\n • Range: 00:45:30 - 00:50:00\n • Range with en-dash: 00:45:30–00:50:00');
});

pasteExample.addEventListener('click', ()=>{
  missInput.value = '00:05:30\n00:15:20 - 00:17:00\n2:30';
});

addBtn.addEventListener('click', ()=>{
  const raw = missInput.value.trim();
  if(!raw){
    alert('Please enter a missed timestamp or range.');
    return;
  }
  // Accept single or range. If input contains newline, split and add many
  const lines = raw.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);
  for(const line of lines){
    const parsed = parseMissInput(line);
    if(parsed === null){
      alert('Could not parse: "'+line+'". Use formats like 00:45:30 or 00:45:30 - 00:50:00');
      continue;
    }
    const id = Date.now().toString(36) + Math.random().toString(36).slice(2,7);
    const entry = Object.assign({rawInput:line, id}, parsed);
    // compute absolute times (if start present)
    if(startSecondsOfDay !== null) {
      entry.absoluteStart = (startSecondsOfDay + entry.offsetStartSec);
      if(entry.type === 'range') entry.absoluteEnd = startSecondsOfDay + entry.offsetEndSec;
    }
    entries.push(entry);
  }
  missInput.value = '';
  refreshUI();
});

clearAll.addEventListener('click', ()=>{
  if(!confirm('Clear all saved missed timestamps?')) return;
  entries = [];
  refreshUI();
});

exportTxt.addEventListener('click', ()=>{
  if(entries.length===0){ alert('No entries to export'); return; }
  let lines = entries.map(e=>{
    if(e.type==='single'){
      const abs = e.absoluteStart!=null ? formatSecondsToHHMMSS(e.absoluteStart) : 'N/A';
      return `${e.rawInput}\t=>\t${abs}`;
    } else {
      const absS = e.absoluteStart!=null ? formatSecondsToHHMMSS(e.absoluteStart) : 'N/A';
      const absE = e.absoluteEnd!=null ? formatSecondsToHHMMSS(e.absoluteEnd) : 'N/A';
      return `${e.rawInput}\t=>\t${absS} - ${absE}`;
    }
  });
  downloadText(lines.join('\n'), 'missed_timestamps.txt');
});

exportCsv.addEventListener('click', ()=>{
  if(entries.length===0){ alert('No entries to export'); return; }
  let csv = 'raw_input,type,offset_start_sec,offset_end_sec,absolute_start,absolute_end\n';
  for(const e of entries){
    csv += `"${e.rawInput.replace(/"/g,'""')}",${e.type},${e.offsetStartSec || ''},${e.offsetEndSec || ''},${e.absoluteStart!=null?formatSecondsToHHMMSS(e.absoluteStart):''},${e.absoluteEnd!=null?formatSecondsToHHMMSS(e.absoluteEnd):''}\n`;
  }
  downloadText(csv, 'missed_timestamps.csv');
});

copyAll.addEventListener('click', async ()=>{
  if(entries.length===0){ alert('No entries to copy'); return; }
  const lines = entries.map(e=>{
    if(e.type==='single') return e.absoluteStart!=null?formatSecondsToHHMMSS(e.absoluteStart):e.rawInput;
    return (e.absoluteStart!=null && e.absoluteEnd!=null)? (formatSecondsToHHMMSS(e.absoluteStart)+' - '+formatSecondsToHHMMSS(e.absoluteEnd)) : e.rawInput;
  });
  try{
    await navigator.clipboard.writeText(lines.join('\\n'));
    alert('All times copied to clipboard');
  }catch(e){
    alert('Could not copy: '+e);
  }
});

/* -------------------------
   Parsing & computation
   ------------------------- */
function parseMissInput(input){
  // Accept delimiters: '-' or '–' or '—'
  let delimMatch = input.match(/(-|–|—)/);
  if(delimMatch){
    const parts = input.split(/[-–—]/).map(p=>p.trim()).filter(Boolean);
    if(parts.length < 2) return null;
    const s1 = parts[0], s2 = parts[1];
    const sec1 = parseTimeStringToSeconds(s1);
    const sec2 = parseTimeStringToSeconds(s2);
    if(sec1===null || sec2===null) return null;
    // ensure start <= end
    const start = Math.min(sec1,sec2), end = Math.max(sec1,sec2);
    return {type:'range', offsetStartSec:start, offsetEndSec:end};
  } else {
    const sec = parseTimeStringToSeconds(input);
    if(sec===null) return null;
    return {type:'single', offsetStartSec:sec};
  }
}

function recomputeAbsoluteTimes(){
  for(const e of entries){
    if(startSecondsOfDay !== null){
      e.absoluteStart = startSecondsOfDay + e.offsetStartSec;
      if(e.type==='range') e.absoluteEnd = startSecondsOfDay + e.offsetEndSec;
    } else {
      e.absoluteStart = null;
      e.absoluteEnd = null;
    }
  }
}

/* -------------------------
   Render UI
   ------------------------- */
function refreshUI(){
  // recompute absolute times if start present
  recomputeAbsoluteTimes();
  // list
  entriesList.innerHTML = '';
  if(entries.length === 0){
    resultsArea.innerHTML = '<div class="muted">No entries yet — add missed timestamps and they will appear below with absolute times.</div>';
    countBadge.textContent = '0';
    statCount.textContent = '0';
    statRanges.textContent = '0';
    return;
  }
  // show summary
  const summaryParts = [];
  if(startSecondsOfDay != null){
    summaryParts.push('Start set to <strong>'+formatSecondsToHHMMSS(startSecondsOfDay)+'</strong>');
  } else {
    summaryParts.push('<span class="error">Start time not set — results show offsets only</span>');
  }
  resultsArea.innerHTML = '<div class="muted">'+summaryParts.join(' • ')+'</div>';

  let rangeCount = 0;
  for(const e of entries.slice().reverse()){ // show latest first
    const item = document.createElement('div'); item.className='item';
    const left = document.createElement('div'); left.style.display='flex'; left.style.flexDirection='column';
    const title = document.createElement('div'); title.style.display='flex'; title.style.gap='12px'; title.style.alignItems='center';
    const rawSpan = document.createElement('div'); rawSpan.className='meta'; rawSpan.textContent = e.rawInput;
    const timeSpan = document.createElement('div'); timeSpan.className='timeblock mono';
    if(e.type==='single'){
      timeSpan.textContent = e.absoluteStart!=null ? formatSecondsToHHMMSS(e.absoluteStart) : formatOffsetForDisplay(e.offsetStartSec);
    } else {
      rangeCount++;
      timeSpan.textContent = (e.absoluteStart!=null && e.absoluteEnd!=null) ? (formatSecondsToHHMMSS(e.absoluteStart)+'  —  '+formatSecondsToHHMMSS(e.absoluteEnd)) : (formatOffsetForDisplay(e.offsetStartSec)+'  —  '+formatOffsetForDisplay(e.offsetEndSec));
    }
    title.appendChild(rawSpan); title.appendChild(timeSpan);
    left.appendChild(title);
    const meta = document.createElement('div'); meta.className='meta'; meta.textContent = e.type==='single' ? ('Offset: '+formatOffsetForDisplay(e.offsetStartSec)) : ('Range: '+formatOffsetForDisplay(e.offsetStartSec)+' — '+formatOffsetForDisplay(e.offsetEndSec));
    left.appendChild(meta);

    const right = document.createElement('div'); right.className='actions';
    const copyBtn = document.createElement('button'); copyBtn.className='chip'; copyBtn.title='Copy absolute time';
    copyBtn.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" style="vertical-align:middle"><path d="M9 12H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg> Copy';
    copyBtn.addEventListener('click', async ()=>{
      let text = '';
      if(e.type==='single'){
        text = e.absoluteStart!=null ? formatSecondsToHHMMSS(e.absoluteStart) : formatOffsetForDisplay(e.offsetStartSec);
      } else {
        text = (e.absoluteStart!=null && e.absoluteEnd!=null) ? (formatSecondsToHHMMSS(e.absoluteStart)+' - '+formatSecondsToHHMMSS(e.absoluteEnd)) : (formatOffsetForDisplay(e.offsetStartSec)+' - '+formatOffsetForDisplay(e.offsetEndSec));
      }
      try{ await navigator.clipbo
